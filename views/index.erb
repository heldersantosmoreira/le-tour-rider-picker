<!DOCTYPE html>
<html>
    <head>
        <title>Le Tour de France 2020 üöµ‚Äç‚ôÇÔ∏è</title>
    </head>
    <body>
        <h1><marquee behavior="scroll" direction="right">Le Tour de France 2020 üöµ‚Äç‚ôÇÔ∏è</marquee></h1>

        <%= styled_flash %>

        <style>
            table, th, td { border: 1px solid black; }
            td { text-align: center; }
            table { width: 100%; }
        </style>

        <h3>Add/edit your pick</h1>
         <form action='/picks/create' method='post'>
            <label for="user_token">Token:</label>
            <input type="password" required="true" id="user_token" name="user_token"><br>
            <label for="stage_number">Stage:</label>
            <input type="number" required="true" min="1" max="21" id="stage_number" name="stage_number"><br>
            <label for="rider_name">Rider name:</label>
            <input type="text" required="true" id="rider_name" name="rider_name"><br>

            <button type="submit">Submit</button>
        </form>

        <br>
        <hr>
        <br>

        <table>
            <tr>
                <th>Stage #</th>
                <th>Date</th>
                <th>Locked at?</th>
                <% @users.each do |user| %>
                    <th><%= user.name %></th>
                <% end %>
            </tr>

            <% @stages.each do |stage| %>
                <% stage_picks = @picks&.select { |p| p.stage == stage } || [] %>
                <tr>
                    <td><%= stage.number %></td>
                    <td><%= stage.date.strftime('%Y-%m-%d') %></td>
                    <td>
                        <% if stage.locked? %>
                            <%= stage.locked_at.to_time.localtime('+01:00').strftime('%Y-%m-%d %H:%M:%S') %>
                        <% else %>
                            <form action='/stage/lock' method='post'>
                                <input type="hidden" required="true" min="1" max="21"
                                       id="stage_number" name="stage_number" value=<%= stage.number %>
                                >
                                <button type="submit" onclick="return confirm('Are you sure you want to lock this stage? This cannot be undone.')">Lock</button>
                            </form>
                        <% end %>
                    </td>
                    <% @users.each do |user| %>
                        <td><%= stage_picks.find { |p| p.stage == stage && p.user_name == user.name } %></td>
                    <% end %>
                </tr>
            <% end %>
        </table>
    </body>
</html>
